---
title: "R Review"
author: "Gabriel"
fate: 01/21/2022
output:
  pdf_document: default
  html_document: default
df_print: paged
---

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

# Converting dates to weekdays

<https://www.youtube.com/watch?v=fsDuiXiMmQg>





```{r}
library(tidyverse)
library(skimr)
library(janitor)
library(lubridate) #working with dates

```

# Reading CSV file

```{r}
df <- read_csv("sleep_activity.csv")
```

\#Inspecting dataset

```{r}
head(df)
```

#Change columns name to lower case

```{r can use rename_with(df, tolower) or clean_names(df)}
df <- clean_names(df)
head(df)
```

```{r}
str(df)
```

# Checking column names

```{r}
colnames(df)
```

to add new columns "mutate(new_df, total = `adr` / adults)"

# "Lesson 3: Changing your data"

You can see the different column names and some sample values to the right of the colon.

```{r}
skim_without_charts(df)
```

```{r}
glimpse(df)
```

```{r}
print("Max total steps")
max(df$total_steps)

print("Min total steps")
min(df$total_steps)

print("Min total steps")
mean(df$total_steps)
```

Filtering rows where totalstep= 0

```{r}
new_df <- 
  filter(df, df$total_steps !=0)
```

# Organizing data functions: arrange(), group_by(), filter()

```{r}

df1 <- 
  df %>% group_by(id) %>% 
  summarise(mean_totalstep = mean(total_steps), mean_calories = mean(calories))


```

```{r}
View(df1)
```

\#Filter users with at least 10,000 average steps

```{r}
View(df1 %>% filter(mean_totalstep >= 10000))
   
```

# Transforming data separate(), unite(), mutate()

--Use mutate to add columns

```{r}
df2 <- 
  df %>% group_by(id) %>% 
  summarise(mean_total_steps = mean(total_steps), sd(total_steps), mean_calories = mean(calories), sd(calories), mean (total_minutes_asleep), sd(total_minutes_asleep), mean(total_time_in_bed), sd(total_time_in_bed))
```

```{r}
View(df2)
```

\#graphing with ggplot2

-aes (size, shape, color, alpha) - use color for colorblind audience -geom_jitter for overlaping points

-   Use geom_bar(mapping = aes (x= id, fill= calories)) for stack barplot

```{r}

df3 <- 
  df %>% 
  mutate(id = as.character(id))

```

```{r}
head(df3)

```






```{r}
ggplot(data=df3) + 
  geom_point(mapping = aes (x= total_steps, y= calories, alpha= id), color = "purple") +
  geom_smooth(mapping = aes (x= total_steps, y= calories))
```

#Label and annotations

https://www.r-graph-gallery.com/233-add-annotations-on-ggplot2-chart.html 
https://ggplot2-book.org/annotations.html

```{r}
ggplot(data=df3) + 
  geom_jitter(mapping = aes (x= total_steps, y= calories, color= id))+
  labs(title = "Fitbit_users: Calories vs Total_steps", subtitle = "Amazon Turk ",
       caption = "Data colelcted using Amazon Mechanical Turk 4-12-2016 to 5-12-2016")+
  annotate("text", x=20000, y = 1000, label = "anyone in here", color = "purple", 
           fontface = "bold", size = 4, angle =25) +
  geom_hline(yintercept=4500, color="orange", size=1)


```

```{r}
ggplot(data=df3) + 
  geom_bar(mapping = aes (x= reorder(id, id,length)))+
  xlab("id") +
  coord_flip()
  
#(mapping = aes (x= reorder(id, id, function(x) - length(x))))
#https://stackoverflow.com/a/9231857/15333580
```


#facet functions in ggplot2

use facet_grid(category1\~category2)


```{r}
ggplot(data = df3, aes(x = total_steps, y = calories))+
geom_line(aes(color = id)) +
facet_wrap(~id)
```

```{r}
df4 <- df3 %>% 
  group_by(id) %>% 
  summarise(
    count = n(),
    calories = mean(calories),
    total_steps = mean(total_steps)
  )# %>% 
#filter(count > 8)

```



```{r}

df4 %>%
  #filter( count > 8 ) %>%
  ggplot( aes(x=total_steps)) +
  geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.5) 
  #geom_histogram()
  


```




```{r}
df5<- subset( df3, select = -c(id, activity_date ) )
head(df5)
```
#correlation heatmap

https://cran.r-project.org/web/packages/ggcorrplot/readme/README.html#:~:text=The%20ggcorrplot%20package%20can%20be,matrix%20of%20correlation%20p%2Dvalues.

```{r}
#install.packages("ggcorrplot")

library(ggcorrplot)
```


```{r}
corr <- round(cor(df5), 1)
ggcorrplot(corr,
           hc.order = TRUE,
           type = "lower",
           lab = TRUE)
```


# Boxplots 






```{r}
ggplot(data = df3) +
  geom_boxplot(
       mapping = aes(x = reorder(id, total_steps, FUN = median),
                     y = total_steps,
                     fill= id,
                     alpha=0.8)) +
  theme(legend.position="none")+
  xlab("id") +
  coord_flip()+
  geom_hline(yintercept=10000, color="orange", size=1) +
  geom_hline(yintercept=5000, color="blue", size=1)






```



#colorblidnness 

https://www.datanovia.com/en/blog/ggplot-colors-best-tricks-you-will-love/ 
http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/#a-colorblind-friendly-palette

```{r}
library(RColorBrewer)
display.brewer.all(colorblindFriendly = TRUE)
```


